<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Update <%= contact.full_name %> - Familia</title>
	<% include ../../home/views/partials/styles.ejs %>
	<link rel="stylesheet" href="/contacts/public/css/contacts.css">
</head>
<body>
	<% if(contact){ %>
	<section class="ui text container">
		<h1 class="ui header">Edit contact :  <%= contact.full_name %></h1>
		<div class="ui grid">
			<div class="four wide column"></div>
			<div class="twelve wide column" id="person_form">
				<form action="/api/contacts/<%= contact._id %>" enctype="multipart/form-data" id="update-contact-form" class="ui form" data-contact-id="<%= contact._id %>">
					<div class="three fields">
						<div class="field">
							<label for="full_name">Full Name</label>
							<input type="text" name="full_name" placeholder="Shajan Jacob" value="<%= contact.full_name %>">
						</div>
						<div class="field">
							<label for="nick_name">Nick Name</label>
							<input type="text" name="nick_name" placeholder="Shajan Jacob" value="<%= contact.nick_name %>">
						</div>
						<div class="field">
							<label for="gender">Gender</label>
							<select name="gender" id="select_gender" class="ui fluid dropdown">
								<option value="<%= contact.gender %>" selected><%= contact.gender.charAt(0).toUpperCase() + contact.gender.slice(2); %></option>
								<option value="male">Male</option>
								<option value="female">Female</option>
							</select>
						</div>
					</div>
					<div class="field">
						<label for="file" class="ui icon button">
							Choose Avatar Image
						</label>
						<input type="file" id="file" name="avatar" style="display:none">
					</div>
					<% if(contact.anniversaries.length>0){ %>
					<% contact.anniversaries.forEach(function(ani){ %>
					<div class="two fields">
						<div class="field">
							<label for="anniversaries[0][title]">Type</label>
							<select name="anniversaries[0][title]" id="select_title" class="ui fluid search dropdown">
								<option value="<%= ani.title %>"><%= ani.title.charAt(0).toUpperCase() + ani.title.slice(1); %></option>
								<option value="birth">Birth</option>
								<option value="wedding">Wedding</option>
								<option value="feast">Feast</option>
								<option value="death">Death</option>
							</select>
						</div>
						<div class="field">
							<label for="anniversaries[0][day]">Date</label>
							<input type="text" name="anniversaries[0][day]" placeholder="YYYY-MM-DD" value="<%= moment(ani.day).format("YYYY-MM-DD"); %>">
						</div>
					</div>
					<% });}else{ %>
					<div class="two fields">
						<div class="field">
							<label for="anniversaries[0][title]">Type</label>
							<select name="anniversaries[0][title]" id="select_title" class="ui fluid search dropdown">
								<option value="birth">Birth</option>
								<option value="wedding">Wedding</option>
								<option value="feast">Feast</option>
								<option value="death">Death</option>
							</select>
						</div>
						<div class="field">
							<label for="anniversaries[0][day]">Date</label>
							<input type="text" name="anniversaries[0][day]" placeholder="YYYY-MM-DD">
						</div>
					</div>
					<% } %>
					<div class="two fields">
						<div class="field">
							<label for="related_to_contact">Person</label>
							<select name="related_to_contact" id="select_person" class="ui search fluid dropdown">
								<option value="none">None</option>
							</select>
						</div>
						<div class="field">
							<label for="reation">Relation</label>
							<select name="relation" id="select_relation" class="ui fluid search dropdown">
								<option value="none">None</option>
								<option value="brother">Brother</option>
								<option value="daughter">Daughter</option>
								<option value="husband">Husband</option>
								<option value="sister">Sister</option>
								<option value="son">Son</option>
								<option value="wife">Wife</option>
							</select>
						</div>
					</div>
					<div class="two fields">
						<div class="field">
							<label for="phone">Phone</label>
							<input type="text" name="phone" placeholder="9191555566" value="<%= contact.phone %>">
						</div>
						<div class="field">
							<label for="email">Email</label>
							<input type="text" name="email" placeholder="username@domain.com" value="<%= contact.email %>">
						</div>
					</div>
					<div class="field">
						<label for="is_dead">Is Dead</label>
						<input type="checkbox" name="is_dead" placeholder="" <% if(contact.is_dead){ %>checked<% } %>>
					</div>
					<input type="submit" value="Add Person" id="update-contact" class="ui fluid primary button">
				</form>
			</div>
		</div>
	</section>
	<% } %>
	<% include ../../home/views/partials/scripts.ejs %>
	<script>
		$('#select_title').dropdown();
		$('#select_relation').dropdown();
		$('#select_gender').dropdown();

		$('#select_person').dropdown({
			fields: {
				name: 'full_name',
				value: '_id'
			},
			apiSettings: {
				url: '/api/contacts/list?full_name={query}',
			},
			localSearch: false
		});

		$('#update-contact').on('click', function(e){
			e.preventDefault();
			$.ajax({
				type: "PUT",
				url: '/api/contacts/' + $('#update-contact-form').data('contact-id'),
				data: new FormData($('form')[0]),
				contentType: false,
				processData: false,
				success: function(data, status, xhr){
					if(xhr.status == 201)
						window.location = "/contacts/list";
				}
			});
		});
	</script>
</body>
</html>